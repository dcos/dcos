#!/bin/bash -xe

mkdir -p /pkg/src/github.com/dcos
mv /pkg/src/dcos-oauth /pkg/src/github.com/dcos/
cd /pkg/src/github.com/dcos/dcos-oauth
make install

mkdir -p $PKG_PATH/bin
cp -v /pkg/bin/dcos-oauth $PKG_PATH/bin

# Create the service file
service="$PKG_PATH/dcos.target.wants_master/dcos-oauth.service"
mkdir -p "$(dirname "$service")"

cp /pkg/extra/dcos-oauth.service "$service"
cp /pkg/extra/dcos_add_user.py "$PKG_PATH/bin/"
chmod +x "$PKG_PATH/bin/dcos_add_user.py"
