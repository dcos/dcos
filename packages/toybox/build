#!/bin/bash
set -x

export CFLAGS="-I/opt/mesosphere/include -I/opt/mesosphere/active/ncurses/include -I/opt/mesosphere/active/openssl/include"
export LDFLAGS="-L/opt/mesosphere/lib -L/opt/mesosphere/active/ncurses/lib -L/opt/mesosphere/active/openssl/lib -Wl,-rpath=/opt/mesosphere/active/ncurses/lib -Wl,-rpath=/opt/mesosphere/active/openssl/lib -Wl,-rpath=/opt/mesosphere/lib"
export CPPFLAGS=${CFLAGS}

mkdir -p $PKG_PATH/bin

pushd /pkg/src/toybox
make defconfig
# TODO: do we need to modify generated config?
# with previous version make fails on: Error in USE_CHRT(chrt (see generated/flags.raw)
# cp /pkg/extra/config .config
make
cp generated/unstripped/toybox $PKG_PATH/bin/toybox_unstripped
cp toybox $PKG_PATH/bin
