From 1b9a9dfec413065f2822cd5941641ab09bfbc282 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Gast=C3=B3n=20Kleiman?= <gaston@mesosphere.io>
Date: Tue, 10 Jul 2018 14:33:16 -0700
Subject: [PATCH] Added `normalizeMetricKey()` and
 `getFrameworkMetricPrefix()`.

Added `normalizeMetricKey()` and `getFrameworkMetricPrefix()`.

Review: https://reviews.apache.org/r/66882/
---
 src/master/metrics.cpp | 18 ++++++++++++++++++
 src/master/metrics.hpp |  6 ++++++
 2 files changed, 24 insertions(+)

diff --git a/src/master/metrics.cpp b/src/master/metrics.cpp
index 5c1d08664..7a1314fbf 100644
--- a/src/master/metrics.cpp
+++ b/src/master/metrics.cpp
@@ -510,6 +510,24 @@ void Metrics::incrementTasksStates(
 }
 
 
+string normalizeMetricKey(const string& key)
+{
+  string name = strings::lower(key);
+  name = strings::trim(name);
+  name = strings::replace(name, " ", "__");
+  name = strings::replace(name, ".", "__");
+  name = strings::replace(name, "/", "__");
+
+  return name;
+}
+
+
+string getFrameworkMetricPrefix(const FrameworkInfo& frameworkInfo)
+{
+  return "master/frameworks/" + normalizeMetricKey(frameworkInfo.name()) +
+    "." + stringify(frameworkInfo.id()) + "/";
+}
+
 } // namespace master {
 } // namespace internal {
 } // namespace mesos {
diff --git a/src/master/metrics.hpp b/src/master/metrics.hpp
index 1ef74dedf..1c2e907ef 100644
--- a/src/master/metrics.hpp
+++ b/src/master/metrics.hpp
@@ -207,6 +207,12 @@ struct Metrics
       const TaskStatus::Reason& reason);
 };
 
+
+std::string normalizeMetricKey(const std::string& key);
+
+
+std::string getFrameworkMetricPrefix(const FrameworkInfo& frameworkInfo);
+
 } // namespace master {
 } // namespace internal {
 } // namespace mesos {
-- 
2.14.1

